---
sidebar: sidebar 
permalink: troubleshooting_collector_svm.html 
keywords: data collector, ONTAP, NetApp, SVM, cloud ontap, firewall 
summary: Risoluzione dei problemi dei collettori di dati di sicurezza del carico di lavoro 
---
= Risoluzione dei problemi del raccoglitore dati ONTAP SVM
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Workload Security utilizza dei collettori di dati per raccogliere dati sui file e sugli accessi degli utenti dai dispositivi.  Qui puoi trovare suggerimenti per la risoluzione dei problemi relativi a questo raccoglitore.

Vedi illink:task_add_collector_svm.html["Configurazione del collettore SVM"] pagina per le istruzioni sulla configurazione di questo raccoglitore.

In caso di errore, è possibile fare clic su _ulteriori dettagli_ nella colonna _Stato_ della pagina Collettori dati installati per ottenere maggiori dettagli sull'errore.

image:CS_Data_Collector_Error.png["Errore del Workload Security Collector Link per maggiori dettagli"]

Di seguito vengono descritti i problemi noti e le relative soluzioni.

'''
*Problema:* Data Collector funziona per un po' di tempo e si arresta dopo un tempo casuale, con il seguente messaggio di errore: "Messaggio di errore: il connettore è in stato di errore. Nome del servizio: audit. Motivo dell'errore: server fpolicy esterno sovraccarico." *Prova questo:* la frequenza degli eventi di ONTAP era molto più alta di quella che la casella Agent può gestire. Di conseguenza la connessione è stata interrotta.

Controlla il picco di traffico in CloudSecure al momento della disconnessione.  Puoi verificarlo dalla pagina *CloudSecure > Activity Forensics > Tutte le attività*.

Se il traffico aggregato di picco è superiore a quello che l'Agent Box può gestire, fare riferimento alla pagina Event Rate Checker per informazioni su come dimensionare la distribuzione del Collector in un Agent Box.

Se l'agente è stato installato nella casella Agente prima del 4 marzo 2021, eseguire i seguenti comandi nella casella Agente:

....
echo 'net.core.rmem_max=8388608' >> /etc/sysctl.conf
echo 'net.ipv4.tcp_rmem = 4096 2097152 8388608' >> /etc/sysctl.conf
sysctl -p
....
Dopo il ridimensionamento, riavviare il raccoglitore dall'interfaccia utente.

{vuoto}

****

****
*Problema:* il Collector segnala il messaggio di errore: "Nessun indirizzo IP locale trovato sul connettore in grado di raggiungere le interfacce dati dell'SVM".  *Prova questo:* Molto probabilmente è dovuto a un problema di rete sul lato ONTAP .  Si prega di seguire questi passaggi:

. Assicurarsi che non vi siano firewall sulla vita dati SVM o sulla vita di gestione che bloccano la connessione dalla SVM.
. Quando si aggiunge una SVM tramite un IP di gestione del cluster, assicurarsi che la vita dati e la vita di gestione della SVM siano pingabili dalla VM dell'agente.  In caso di problemi, controllare il gateway, la netmask e i percorsi per lif.
+
Puoi anche provare ad accedere al cluster tramite ssh utilizzando l'IP di gestione del cluster ed effettuare il ping dell'IP dell'agente.  Assicurarsi che l'IP dell'agente sia pingabile:

+
 network ping -vserver <vserver name> -destination <Agent IP> -lif <Lif Name> -show-detail
+
Se non è possibile effettuare il ping, assicurarsi che le impostazioni di rete in ONTAP siano corrette, in modo che la macchina dell'agente sia pingabile.

. Se hai provato a connetterti tramite l'IP del cluster e non funziona, prova a connetterti direttamente tramite l'IP SVM.  Per i passaggi necessari per connettersi tramite IP SVM, vedere quanto sopra.
. Durante l'aggiunta del collettore tramite IP SVM e credenziali vsadmin, verificare se SVM Lif ha abilitato il ruolo Data plus Mgmt.  In questo caso il ping all'SVM Lif funzionerà, ma l'SSH all'SVM Lif non funzionerà.  In caso affermativo, creare un SVM Mgmt Only Lif e provare a connettersi tramite questo SVM Management Only Lif.
. Se ancora non funziona, crea un nuovo SVM Lif e prova a connetterti tramite quel Lif.  Assicurarsi che la subnet mask sia impostata correttamente.
. Debug avanzato:
+
.. Avvia una traccia dei pacchetti in ONTAP.
.. Provare a connettere un data collector all'SVM dall'interfaccia utente di CloudSecure.
.. Attendi finché non compare l'errore.  Arresta la traccia dei pacchetti in ONTAP.
.. Aprire la traccia del pacchetto da ONTAP.  È disponibile in questa posizione
+
 https://<cluster_mgmt_ip>/spi/<clustername>/etc/log/packet_traces/
.. Assicurarsi che ci sia un SYN da ONTAP alla casella Agent.
.. Se non c'è SYN da ONTAP , allora c'è un problema con il firewall in ONTAP.
.. Aprire il firewall in ONTAP, in modo che ONTAP possa connettersi alla casella agente.


. Se il problema persiste, consultare il team di rete per accertarsi che nessun firewall esterno stia bloccando la connessione da ONTAP alla casella Agent.
. Se nessuna delle soluzioni precedenti risolve il problema, apri un caso conlink:concept_requesting_support.html["Supporto Netapp"] per ulteriore assistenza.


{vuoto}

'''
*Problema:* Messaggio: "Impossibile determinare il tipo ONTAP per [nome host: <indirizzo IP>.  Motivo: Errore di connessione al sistema di archiviazione <Indirizzo IP>: Host non raggiungibile (Host non raggiungibile) *Prova questo:*

. Verificare che sia stato fornito l'indirizzo IP di gestione SVM o l'IP di gestione del cluster corretto.
. Eseguire l'SSH sull'SVM o sul Cluster a cui si intende connettersi.  Una volta effettuata la connessione, assicurarsi che il nome SVM o Cluster sia corretto.


{vuoto}

'''
*Problema:* Messaggio di errore: "Il connettore è in stato di errore.  Nome del servizio: audit.  Motivo dell'errore: server fpolicy esterno terminato."  *Prova questo:*

. È molto probabile che un firewall stia bloccando le porte necessarie nella macchina dell'agente.  Verificare che l'intervallo di porte 35000-55000/tcp sia aperto affinché la macchina agente possa connettersi dall'SVM.  Assicurarsi inoltre che non vi siano firewall abilitati sul lato ONTAP che bloccano la comunicazione con la macchina agente.
. Digitare il seguente comando nella casella Agente e assicurarsi che l'intervallo di porte sia aperto.
+
 sudo iptables-save | grep 3500*
+
L'output di esempio dovrebbe apparire così:

+
 -A IN_public_allow -p tcp -m tcp --dport 35000 -m conntrack -ctstate NEW -j ACCEPT
. Accedi a SVM, inserisci i seguenti comandi e verifica che non sia impostato alcun firewall per bloccare la comunicazione con ONTAP.
+
....
system services firewall show
system services firewall policy show
....
+
link:https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-nmg%2FGUID-969851BB-4302-4645-8DAC-1B059D81C5B2.html["Controlla i comandi del firewall"]sul lato ONTAP .

. Accedi tramite SSH all'SVM/Cluster che vuoi monitorare.  Eseguire il ping della casella Agent dalla libreria dati SVM (con supporto dei protocolli CIFS e NFS) e assicurarsi che il ping funzioni:
+
 network ping -vserver <vserver name> -destination <Agent IP> -lif <Lif Name> -show-detail
+
Se non è possibile effettuare il ping, assicurarsi che le impostazioni di rete in ONTAP siano corrette, in modo che la macchina dell'agente sia pingabile.

. Se un singolo SVM viene aggiunto due volte a un tenant tramite 2 collettori dati, verrà visualizzato questo errore.  Eliminare uno dei collettori di dati tramite l'interfaccia utente.  Quindi riavviare l'altro raccoglitore dati tramite l'interfaccia utente.  Quindi il raccoglitore dati mostrerà lo stato "IN ESECUZIONE" e inizierà a ricevere eventi da SVM.
+
In pratica, in un tenant, 1 SVM dovrebbe essere aggiunto una sola volta, tramite 1 data collector.  1 SVM non dovrebbe essere aggiunto due volte tramite 2 collettori di dati.

. Nei casi in cui lo stesso SVM è stato aggiunto in due diversi ambienti Workload Security (tenant), l'ultimo riuscirà sempre.  Il secondo collettore configurerà fpolicy con il proprio indirizzo IP ed espellerà il primo.  Quindi il collettore nel primo smetterà di ricevere eventi e il suo servizio di "audit" entrerà in stato di errore.  Per evitare ciò, configurare ogni SVM su un singolo ambiente.
. Questo errore può verificarsi anche se i criteri di servizio non sono configurati correttamente.  Con ONTAP 9.8 o versioni successive, per connettersi al Data Source Collector, è necessario il servizio data-fpolicy-client insieme al servizio dati data-nfs e/o data-cifs.  Inoltre, il servizio data-fpolicy-client deve essere associato ai dati lif per l'SVM monitorato.


{vuoto}

'''
*Problema:* Nessun evento visualizzato nella pagina delle attività.  *Prova questo:*

. Verificare se il collettore ONTAP è nello stato "IN ESECUZIONE".  In caso affermativo, assicurarsi che alcuni eventi cifs vengano generati sulle VM client cifs aprendo alcuni file.
. Se non vengono rilevate attività, effettuare l'accesso all'SVM e immettere il seguente comando.
+
 <SVM>event log show -source fpolicy
+
Assicurati che non ci siano errori relativi a fpolicy.

. Se non vengono visualizzate attività, effettuare l'accesso all'SVM. Immettere il seguente comando:
+
 <SVM>fpolicy show
+
Verificare se la policy fpolicy denominata con prefisso “cloudsecure_” è stata impostata e lo stato è “on”.  Se non è impostato, molto probabilmente l'agente non è in grado di eseguire i comandi nell'SVM.  Si prega di assicurarsi che siano stati rispettati tutti i prerequisiti descritti all'inizio della pagina.



{vuoto}

****

****
*Problema:* SVM Data Collector è in stato di errore e il messaggio di errore è "L'agente non è riuscito a connettersi al raccoglitore". *Prova questo:*

. Molto probabilmente l'agente è sovraccarico e non riesce a connettersi ai collettori dell'origine dati.
. Controllare quanti collettori di origini dati sono connessi all'agente.
. Controllare anche la velocità del flusso di dati nella pagina "Tutte le attività" nell'interfaccia utente.
. Se il numero di attività al secondo è significativamente elevato, installare un altro agente e spostare alcuni dei Data Source Collector sul nuovo agente.


{vuoto}

'''
*Problema:* SVM Data Collector mostra il messaggio di errore "fpolicy.server.connectError: il nodo non è riuscito a stabilire una connessione con il server FPolicy "12.195.15.146" (motivo: "Selezione scaduta")" *Prova questo:* il firewall è abilitato in SVM/Cluster.  Quindi il motore fpolicy non è in grado di connettersi al server fpolicy.  Le CLI in ONTAP che possono essere utilizzate per ottenere maggiori informazioni sono:

....
event log show -source fpolicy which shows the error
event log show -source fpolicy -fields event,action,description which shows more details.
....
link:https://docs.netapp.com/ontap-9/index.jsp?topic=%2Fcom.netapp.doc.dot-cm-nmg%2FGUID-969851BB-4302-4645-8DAC-1B059D81C5B2.html["Controlla i comandi del firewall"]sul lato ONTAP .

{vuoto}

****

****
*Problema:* Messaggio di errore: "Il connettore è in stato di errore.  Nome del servizio: audit.  Motivo dell'errore: Nessuna interfaccia dati valida (ruolo: dati, protocolli dati: NFS o CIFS o entrambi, stato: attivo) trovata sull'SVM."  *Prova questo:* assicurati che ci sia un'interfaccia operativa (che abbia il ruolo di dati e protocollo dati come CIFS/NFS).

{vuoto}

'''
*Problema:* il raccoglitore dati entra nello stato di errore e poi, dopo un po' di tempo, passa allo stato di esecuzione, per poi tornare nuovamente allo stato di errore.  Questo ciclo si ripete.  *Prova questo:* Questo accade in genere nel seguente scenario:

. Sono stati aggiunti più raccoglitori di dati.
. Ai collettori di dati che mostrano questo tipo di comportamento verrà aggiunto 1 SVM.  Ciò significa che 2 o più collettori di dati sono collegati a 1 SVM.
. Assicurarsi che 1 raccoglitore dati si connetta a 1 solo SVM.
. Eliminare gli altri raccoglitori di dati connessi allo stesso SVM.


{vuoto}

'''
*Problema:* Il connettore è in stato di errore.  Nome del servizio: audit.  Motivo dell'errore: Impossibile configurare (policy su SVM svmname.  Motivo: Valore non valido specificato per l'elemento 'shares-to-include' in 'fpolicy.policy.scope-modify: "Federal' *Prova questo:* *I nomi delle condivisioni devono essere specificati senza virgolette.  Modificare la configurazione DSC ONTAP SVM per correggere i nomi delle condivisioni.

_Includi ed escludi azioni_ non è pensato per un lungo elenco di nomi di azioni.  Se hai un gran numero di azioni da includere o escludere, utilizza il filtro per volume.

{vuoto}

'''
*Problema:* Nel cluster sono presenti fpolicies esistenti che non sono utilizzati.  Cosa si dovrebbe fare prima di installare Workload Security?  *Prova questo:* Si consiglia di eliminare tutte le impostazioni fpolicy esistenti e non utilizzate, anche se sono in stato disconnesso.  Workload Security creerà fpolicy con il prefisso "cloudsecure_".  Tutte le altre configurazioni fpolicy non utilizzate possono essere eliminate.

Comando CLI per visualizzare l'elenco fpolicy:

 fpolicy show
Passaggi per eliminare le configurazioni fpolicy:

....
fpolicy disable -vserver <svmname> -policy-name <policy_name>
fpolicy policy scope delete -vserver <svmname> -policy-name <policy_name>
fpolicy policy delete -vserver <svmname> -policy-name <policy_name>
fpolicy policy event delete -vserver <svmname> -event-name <event_list>
fpolicy policy external-engine delete -vserver <svmname> -engine-name <engine_name>
....
{vuoto}

'''
*Problema:* Dopo aver abilitato Workload Security, le prestazioni ONTAP risultano compromesse: la latenza diventa sporadicamente elevata, mentre gli IOPS diventano sporadicamente bassi.  *Prova questo:* Durante l'utilizzo di ONTAP con Workload Security, a volte si possono verificare problemi di latenza in ONTAP.  Le possibili cause di ciò sono molteplici, come indicato di seguito:link:https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1372994["1372994"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1415152["1415152"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1438207["1438207"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1479704["1479704"] , https://mysupport.netapp.com/site/bugs-online/product/ONTAP/BURT/1354659["1354659"] . Tutti questi problemi sono stati risolti in ONTAP 9.13.1 e versioni successive; si consiglia vivamente di utilizzare una di queste versioni successive.

{vuoto}

'''
*Problema:* Data Collector mostra il messaggio di errore: "Errore: impossibile determinare lo stato del collector entro 2 tentativi, provare a riavviare nuovamente il collector (codice errore: AGENT008)".  *Prova questo:*

. Nella pagina dei raccoglitori di dati, scorrere verso destra del raccoglitore di dati che ha generato l'errore e fare clic sul menu con i 3 puntini.  Selezionare _Modifica_.  Inserire nuovamente la password del raccoglitore dati.  Salvare il raccoglitore dati premendo il pulsante _Salva_.  Data Collector verrà riavviato e l'errore dovrebbe essere risolto.
. La macchina dell'agente potrebbe non avere abbastanza CPU o RAM, ecco perché i DSC non funzionano.  Controllare il numero di Data Collector aggiunti all'agente nella macchina.  Se è superiore a 20, aumentare la capacità della CPU e della RAM della macchina agente.  Una volta aumentata la CPU e la RAM, i DSC entreranno automaticamente nello stato di inizializzazione e poi in quello di esecuzione.  Consulta la guida alle taglie sulink:concept_cs_event_rate_checker.html["questa pagina"] .


{vuoto}

'''
*Problema:* il Data Collector genera un errore quando è selezionata la modalità SVM.  *Prova questo:* durante la connessione in modalità SVM, se per la connessione viene utilizzato l'IP di gestione del cluster anziché l'IP di gestione SVM, la connessione genererà un errore.  Assicurarsi che venga utilizzato l'IP SVM corretto.

{vuoto}

'''
*Problema:* Il raccoglitore dati mostra un messaggio di errore quando la funzione Accesso negato è abilitata: "Il connettore è in stato di errore.  Nome del servizio: audit.  Motivo dell'errore: impossibile configurare fpolicy su SVM test_svm.  Motivo: L'utente non è autorizzato."  *Prova questo:* L'utente potrebbe non disporre delle autorizzazioni REST necessarie per la funzionalità Accesso negato.  Si prega di seguire le istruzioni sulink:concept_ws_integration_with_ontap_access_denied.html["questa pagina"] per impostare i permessi.

Una volta impostate le autorizzazioni, riavviare il raccoglitore.

{vuoto}

'''
*Problema:* Il collettore è in stato di errore con il messaggio: Il connettore è in stato di errore.  Motivo dell'errore: impossibile configurare l'archivio persistente su SVM <Nome SVM>.  Motivo: impossibile trovare un aggregato adatto per il volume "<volumeName>" in SVM "<SVM Name>".  Motivo: le informazioni sulle prestazioni per l'aggregato "<aggregateName>" non sono attualmente disponibili.  Attendi qualche minuto e riprova il comando. Nome del servizio: audit. Motivo dell'errore: Impossibile configurare l'archivio persistente su SVM <SVM Name>. Motivo: Impossibile trovare un aggregato adatto per il volume "<volumeName>" in SVM "<SVM Name>". Motivo: le informazioni sulle prestazioni per l'aggregato "<aggregateName>" non sono attualmente disponibili. Attendi qualche minuto e riprova a eseguire il comando.

*Prova questo:* attendi qualche minuto e poi riavvia il Collector.

{vuoto}

'''
Se riscontri ancora problemi, contatta l'assistenza tramite i link indicati nella pagina *Aiuto > Assistenza*.
