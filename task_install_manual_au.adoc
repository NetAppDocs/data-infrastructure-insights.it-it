---
sidebar: sidebar 
permalink: task_install_manual_au.html 
keywords: Acquisition Unit, AU, install, configure, Linux, add, remove, uninstall, delete, deleting, move, moving, manual, AU, Patch 
summary: È possibile configurare Data Infrastructure Insights affinché il software AU venga aggiornato manualmente, garantendo un maggiore controllo sul software installato sul tenant. 
---
= Installazione manuale del software dell'unità di acquisizione
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Per impostazione predefinita, Data Infrastructure Insights aggiorna automaticamente il software Acquisition Unit (AU) man mano che vengono distribuiti gli aggiornamenti.  Tuttavia, in ambienti controllati e sicuri, l'aggiornamento automatico potrebbe non essere possibile o desiderato.  In questi casi, Data Infrastructure Insights può essere configurato per l'aggiornamento manuale del software AU, garantendo un maggiore controllo sul software installato sul tenant.

Per scaricare e installare manualmente il software AU, procedere come segue.  Data Infrastructure Insights fornisce una pagina di documentazione Swagger utile che puoi utilizzare per molti di questi passaggi oppure puoi usare il tuo script/comandi API.  Vai su Amministrazione > Accesso API e clicca sul link "Documentazione API".

Il procedimento è simile per Linux e Windows.



== Esecuzione di una NUOVA installazione AU su Linux:

. In Data Infrastructure Insights, crea un token API.
+
.. Vai su *Amministrazione > Accesso API* e seleziona *+Token di accesso API*.
+
... Imposta un *Nome* e una *Descrizione* facili da identificare
... Tipo: Scegli *Unità di acquisizione* e *Raccolta dati*
... Permessi: *Lettura/Scrittura*
... Seleziona i valori desiderati per *Scadenza* e *Rinnovo automatico*


.. Fai clic su *Salva*
.. Copia il token di accesso API generato.  Questo passaggio deve essere eseguito prima di poter chiudere la finestra.




image:Manual_AU_Create_API_Token.png["Crea token API"]

. In Swagger (Amministrazione > Accesso API > Documentazione API), utilizzare il token per autorizzare le API Data Infrastructure Insights
+
.. Fare clic su _Autorizza_ in alto a destra nella schermata Swagger
.. Incolla il token copiato sopra nel campo Customer APIKey
.. Fai clic su *Autorizza*
.. Chiudi la finestra




image:Manual_AU_Authorization.png["Autorizza il token API"]

. Scarica l'AU Installer utilizzando l'API _/au/installers/{platform}/latest_ o _/au/installers/{platform}/{version}_:
+
.. Piattaforma: *linux*
.. Versione: *<versione>* (ultima o specificata)




image:Manual_AU_API_Retrieve_latest.png["API per recuperare l'ultima versione AU"]


NOTE: Se non si desidera scaricare la versione più recente, verificare con NetApp la versione AU da specificare per il download.

. Fare clic su *Scarica file*.  Se si eseguono questi passaggi su un sistema diverso dal sistema AU, copiare il file scaricato sul sistema AU.
. In alternativa, è possibile eseguire il comando CURL risultante sul sistema AU:
+
 curl -X GET "<tenant>/rest/v1/au/installers/linux/<AU version>" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <token>"
. A questo punto, il file di installazione dovrebbe essere presente sul sistema AU.



IMPORTANT: I passaggi successivi richiedono l'uso di un token temporaneo.  Non utilizzare il token di accesso API creato sopra.

. Nell'API Swagger Data Infrastructure Insights , crea un token monouso utilizzando l'API _/au/oneTimeToken_.
+
.. Copia il token monouso risultante.




image:Manual_AU_one_time_token.png["Crea un token API monouso"] image:Manual_AU_one_time_token_response.png["Risposta per esempio di token API monouso"]

. Sul computer in cui verrà installato l'AU, accedere alla cartella contenente il file di installazione scaricato.  I comandi seguenti richiedono che l'utente disponga dei permessi di root.
+
.. Decomprimi il file di installazione
.. Cambiare directory nella cartella di installazione risultante
.. Esportare il token monouso e la versione del programma di installazione nelle variabili di ambiente eseguendo quanto segue:
+
 export TOKEN=<One-Time Token>
.. Eseguire quanto segue per installare CI con un utente e un gruppo personalizzati:
+
 ./cloudinsights-install.sh <custom user> <custom group>
+
Nota: se non si desidera utilizzare un utente e un gruppo personalizzati, è possibile utilizzare l'utente e il gruppo predefiniti "cisys".  In questo caso, eseguire il comando di installazione sopra indicato, ma non specificare l'utente e il gruppo.





A questo punto, il software AU è installato sul sistema ed è accessibile all'utente e al gruppo personalizzati.  Tuttavia, non è possibile aggiungere raccoglitori di dati.  Per farlo manualmente, leggere le seguenti istruzioni.  Se vuoi solo installare una patch, vedi<<downloading-a-patch,Toppa>> sezione sottostante.



== Installazione manuale dei collettori dati

Scarica l'ultima versione di datasources.war utilizzando l'API /collector/patch/datasourceswar/latest:

image:API_Manual_Download_datasources.png["API per recuperare gli ultimi datasources.war"]

Nota: se non si desidera scaricare la versione più recente, verificare con NetApp la versione da specificare per il download.

Fare clic su Scarica file.  Se si eseguono questi passaggi su un sistema diverso dal sistema AU, copiare il pacchetto zip datasources.war scaricato nel sistema AU.

Assicurati che il bundle zip datasources.war sia copiato nella seguente directory: /var/lib/netapp/cloudinsights/acq/download

Passare alla directory /var/lib/netapp/cloudinsights/acq/download per datasources.war e verificare il file zip presente:

. Per i passaggi successivi è necessario passare all'utente personalizzato (o uscire da root ed effettuare l'accesso con esso).
+
 su <custom user>
+
Nota: se si utilizza l'utente e il gruppo predefiniti "cisys", non è necessario eseguire questo passaggio.

+
Nota: l'utente personalizzato può essere qualsiasi utente membro di un gruppo personalizzato fornito a cloudinsights-install.sh durante l'installazione di AU e può essere uguale o diverso dall'utente personalizzato fornito durante l'installazione di AU.

. Eseguire le seguenti operazioni:
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/datasources-war-<version>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 datasources-war-<version>.zip
…
....
+
Nota: se si utilizza l'utente e il gruppo "cisys", questi verranno visualizzati nell'output sopra.

+
Nota: se si prevede di eseguire l'installazione utilizzando diversi utenti personalizzati, assicurarsi che le autorizzazioni di gruppo siano impostate su lettura e scrittura sia per il proprietario che per il gruppo (chmod 660 …)

. Riavviare l'UA.  In Data Infrastructure Insights, vai su Osservabilità > Collettori e seleziona la scheda Unità di acquisizione.  Selezionare Riavvia dal menu a “tre punti” a destra dell’AU.




== Scaricare una patch

Scarica la patch utilizzando l'API /collector/patch/file/{version}:

image:API_Manual_Download_patch.png["API per recuperare la patch"]

Nota: confermare con NetApp la versione da specificare per il download.

Fare clic su Scarica file.  Se si eseguono questi passaggi su un sistema diverso dal sistema AU, copiare il pacchetto zip della patch scaricato nel sistema AU.

Assicurati che il pacchetto zip della patch sia copiato nella seguente directory: /var/lib/netapp/cloudinsights/acq/download

Vai alla directory /var/lib/netapp/cloudinsights/acq/download per la patch e verifica il file .zip presente lì:

. Per i passaggi successivi è necessario passare all'utente personalizzato (o uscire da root ed effettuare l'accesso con esso).
+
 su <custom user>
+
Nota: se si utilizza l'utente e il gruppo predefiniti "cisys", non è necessario eseguire questo passaggio.

+
Nota: l'utente personalizzato può essere qualsiasi utente membro di un gruppo personalizzato fornito a cloudinsights-install.sh durante l'installazione di AU e può essere uguale o diverso dall'utente personalizzato fornito durante l'installazione di AU.

. Eseguire le seguenti operazioni:
+
....
chmod 770 /var/lib/netapp/cloudinsights/acq/download/<patch_file_name>.zip
ls -al /var/lib/netapp/cloudinsights/acq/download
…
drwxrwx--- 2 test-user2 test-group-1  4096 Feb 16 10:10 <patch_file_name>.zip
…
....
+
Nota: se si utilizza l'utente e il gruppo "cisys", questi verranno visualizzati nell'output sopra.

+
Nota: se si prevede di eseguire l'installazione utilizzando diversi utenti personalizzati, assicurarsi che le autorizzazioni di gruppo siano impostate su lettura e scrittura sia per il proprietario che per il gruppo (chmod 660 …)

. Riavviare l'UA.  In Data Infrastructure Insights, vai su Osservabilità > Collettori e seleziona la scheda Unità di acquisizione.  Selezionare Riavvia dal menu a “tre punti” a destra dell’AU.




== Recupero della chiave esterna

Se si fornisce uno script shell UNIX, questo può essere eseguito dall'unità di acquisizione per recuperare la *chiave privata* e la *chiave pubblica* dal sistema di gestione delle chiavi.

Per recuperare la chiave, Data Infrastructure Insights eseguirà lo script, passando due parametri: _key id_ e _key type_.  _Key id_ può essere utilizzato per identificare la chiave nel sistema di gestione delle chiavi.  Il _tipo di chiave_ è "pubblico" o "privato".  Quando il tipo di chiave è "pubblico", lo script deve restituire la chiave pubblica.  Quando il tipo di chiave è "privato", è necessario restituire la chiave privata.

Per inviare la chiave all'unità di acquisizione, lo script deve stamparla sull'output standard.  Lo script deve stampare _solo_ la chiave sull'output standard; nessun altro testo deve essere stampato sull'output standard.  Una volta che la chiave richiesta viene stampata sull'output standard, lo script deve uscire con un codice di uscita pari a 0; qualsiasi altro codice di ritorno è considerato un errore.

Lo script deve essere registrato con l'unità di acquisizione tramite lo strumento SecurityAdmin, che eseguirà lo script insieme all'unità di acquisizione.  Lo script deve avere i permessi di _lettura_ ed _esecuzione_ per l'utente root e "cisys".  Se lo script shell viene modificato dopo la registrazione, lo script shell modificato deve essere nuovamente registrato nell'unità di acquisizione.

|===


| parametro di input: ID chiave | Identificatore chiave utilizzato per identificare la chiave nel sistema di gestione delle chiavi del cliente. 


| parametro di input: tipo di chiave | pubblico o privato. 


| produzione | La chiave richiesta deve essere stampata sull'output standard.  Attualmente è supportata la chiave RSA a 2048 bit.  Le chiavi devono essere codificate e stampate nel seguente formato: formato chiave privata: PEM, codificato DER PKCS8 PrivateKeyInfo RFC 5958 formato chiave pubblica: PEM, codificato DER X.509 SubjectPublicKeyInfo RFC 5280 


| codice di uscita | Codice di uscita zero in caso di successo.  Tutti gli altri valori di uscita sono considerati fallimentari. 


| permessi di script | Lo script deve avere i permessi di lettura ed esecuzione per l'utente root e "cisys". 


| registri | Le esecuzioni degli script vengono registrate.  I log possono essere trovati in - /var/log/netapp/cloudinsights/securityadmin/securityadmin.log /var/log/netapp/cloudinsights/acq/acq.log 
|===