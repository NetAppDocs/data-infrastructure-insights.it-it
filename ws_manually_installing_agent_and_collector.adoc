---
sidebar: sidebar 
permalink: ws_manually_installing_agent_and_collector.html 
keywords: install, configure, agent, collector, workload, security, cloud secure 
summary: Gli agenti Workload Security possono essere installati o aggiornati manualmente, garantendo un maggiore controllo sul software installato sul tenant. 
---
= Installazione manuale di Workload Security Agent e Collector
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Per impostazione predefinita, quando è disponibile una nuova versione di un agente o di un collettore Workload Security, viene inviata una notifica pre-aggiornamento e gli agenti e i collettori vengono aggiornati automaticamente sul tenant.  Tuttavia, in un ambiente controllato e protetto, gli aggiornamenti automatici potrebbero non essere desiderati.  In questi casi, Workload Security può essere configurato per l'installazione/l'aggiornamento manuale di agenti e collettori, garantendo un maggiore controllo sul software installato sui sistemi.



== Prima di iniziare

. Verificare in Swagger che le categorie API denominate "cloudsecure_installers.agent" e "cloudsecure_installers.collector" siano disponibili.  In caso contrario, il supporto per l'installazione manuale dell'agente non è abilitato.  Contattare l'assistenza NetApp per abilitare la funzionalità.
+
image:ws_manual_install_APIs.png["API di installazione manuale"]

. Eseguire tutti i comandi menzionati in questo documento come utente 'root' oppure, se si esegue con un utente diverso, eseguire i comandi con 'sudo'.




== Installazione di un nuovo agente

. Crea un nuovo token di accesso all'API Workload Security.
+
.. Vai su *Amministrazione > Accesso API*.  Selezionare la scheda "Token di sicurezza del carico di lavoro" e fare clic su "+ Token di accesso API".
+
... Imposta un nome e una descrizione facili da identificare.
... Nel menu a discesa "Quali tipi di API verranno chiamate da questo token?", seleziona _Gestione del collettore_ e _Installazione agente e collettore_.
... Selezionare la durata di scadenza desiderata.


.. Fare clic su _Salva_.




[[copy-access-token]]
. Copia il token di accesso API generato.  Si prega di notare che una volta chiusa la finestra, il token non potrà più essere recuperato.  In tal caso sarà necessario generare un nuovo token.
+
image:ws_create_and_save_token.png["Crea e salva il token API"]

+
image:ws_create_and_save_token_confirm.png["Conferma la creazione del token"]

+
.. Vai su *Amministrazione > Accesso API > Documentazione API* (in alto a destra della pagina) e seleziona l'icona _Sicurezza del carico di lavoro_.  Si apre la documentazione Swagger per le API di sicurezza del carico di lavoro.
+
image:ws_swagger_documentation_link.png["Documentazione Swagger per la sicurezza del carico di lavoro"]

.. Autorizza l'accesso alle API di _Workload Security_.


. Fare clic sul pulsante _Autorizza_ in alto a destra della pagina.
. Nel campo di testo _Customer ApiKey (apiKey)_, incolla il token API precedentemente copiato da<<copy-access-token,Fase 1c>> .
. Fare clic su _Autorizza_ e chiudere la finestra.
+
image:ws_API_authorization.png["Autorizza l'API"]

+
.. Scarica il programma di installazione dell'agente.


. In Swagger, seleziona _cloudsecure_installers.agent_ > API _/v1/cloudsecure/agents/installers/{platform}/latest_ (GET).  Fai clic su _Provalo_.
. Nel campo _piattaforma_, immettere _linux_.  Fare clic su _Esegui_.
+
image:ws_installers_agent_api_swagger.png["Swagger per l'API di installazione dell'agente - top"] image:ws_installers_agent_api_swagger-2.png["Swagger per l'API di installazione dell'agente - risposta"]

. Fare clic su "Scarica file" per scaricare il programma di installazione.
. Se il file di installazione viene scaricato esternamente su una macchina diversa dal sistema in cui deve essere installato l'agente, copiare il file di installazione su tale sistema.
. In alternativa, è possibile copiare il comando curl ed eseguirlo direttamente nel sistema in cui deve essere installato l'agente.
+
** Aggiungere l'argomento "-o {{file_name}}" al comando curl per salvare il file di installazione con il nome desiderato.  Il nome effettivo del file di installazione si trova nella sezione delle intestazioni delle risposte di Swagger.  Si può usare anche questo nome.
+
image:ws_installers_agent_api_swagger_installer_file.png["Scelta dell'agente più recente tramite API - Swagger"]

** Sebbene il file possa essere scaricato in qualsiasi posizione, si consiglia di scaricarlo in una cartella vuota in cui è possibile estrarre il file .zip del programma di installazione.
+
... Crea una nuova cartella (consigliato), copia il file di installazione in questa cartella e decomprimilo:
+
[listing]
----
[root@demo-agent /]# mkdir agent_installers
[root@demo-agent /]# cd agent_installers/
[root@demo-agent agent_installers]# pwd
/agent_installers
[root@demo-agent agent_installers]# ll
total 0
[root@demo-agent agent_installers]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/agents/installers/linux/latest" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cloudsecure-linux-agent-installer-1.617.0.zip
[root@demo-agent agent_installers]# ll
total 76012
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip
----
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.617.0.zip
Archive:  cloudsecure-linux-agent-installer-1.617.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
----
... Imposta l'autorizzazione _execute_ per il file “cloudsecure-agent-install.sh”.
+
[listing]
----
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-install.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154250 Apr 26 06:37 cloudsecure-agent-image.zip
-rwx------ 1 root root    16574 Apr 26 06:25 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26 06:25 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834705 Apr 26 14:34 cloudsecure-linux-agent-installer-1.617.0.zip

----
... Genera un token monouso per l'installazione del nuovo agente.
+
Nota: il token monouso generato in questo passaggio è diverso dal token di accesso API generato in<<copy-access-token,Fase 1c>> .





. In Swagger, esegui _cloudsecure_installers.agent > /v1/cloudsecure/agent/oneTimeToken_ API e copia il token dalla risposta.
+
.. Esportare il token monouso come variabile di ambiente.
+
[listing]
----
[root@demo-agent ~]# export TOKEN=<<one time token generated in step 7>>
----
.. Se si utilizza un server proxy, esportare https_proxy come variabile di ambiente nel formato indicato di seguito.
+
[listing]
----
[root@demo-agent ~]# export HTTPS_PROXY='USER:PASSWORD@PROXY_SERVER:PORT'
----
.. Facoltativo: per impostazione predefinita, l'agente e i collettori verranno installati nel percorso "/opt/netapp".  Per installare in un percorso diverso, impostare la seguente variabile d'ambiente"
+
[listing]
----
[root@demo-agent ~]# export AGENT_INSTALL_PATH=/test_user/apps
----
+
Nota: se installato in un percorso personalizzato, i collettori di dati e tutti gli altri artefatti, come i registri degli agenti, verranno creati solo all'interno del percorso personalizzato.  I log di installazione saranno comunque presenti in - _/var/log/netapp/cloudsecure/install_.

.. Torna alla directory in cui è stato scaricato il programma di installazione dell'agente ed esegui "cloudsecure-agent-install.sh"
+
[listing]
----
[root@demo-agent agent_installers]# ./ cloudsecure-agent-install.sh
----
+
Nota: se l'utente non sta eseguendo una shell "bash", il comando export potrebbe non funzionare.  In tal caso, i passaggi da 8 a 11 possono essere combinati ed eseguiti come di seguito.  HTTPS_PROXY e AGENT_INSTALL_PATH sono facoltativi e possono essere ignorati se non richiesti.

+
[listing]
----
sudo /bin/bash -c "TOKEN=<<one time token generated in step 7>> HTTPS_PROXY=<<proxy details in the format mentioned in step 9>> AGENT_INSTALL_PATH=<<custom_path_to_install_agent>> ./cloudsecure-agent-install.sh"
----
+
A questo punto, l'agente dovrebbe essere installato correttamente.

.. Controllo di integrità per l'installazione dell'agente:


. Eseguire “systemctl status cloudsecure-agent.service” e verificare che il servizio agente sia in stato _running_.
+
[listing]
----
[root@demo-agent ~]# systemctl status cloudsecure-agent.service
 cloudsecure-agent.service - Cloud Secure Agent Daemon Service
   Loaded: loaded (/usr/lib/systemd/system/cloudsecure-agent.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2024-04-26 02:50:37 EDT; 12h ago
 Main PID: 15887 (java)
    Tasks: 72
   CGroup: /system.slice/cloudsecure-agent.service
           ├─15887 java -Dconfig.file=/test_user/apps/cloudsecure/agent/conf/application.conf -Dagent.proxy.host= -Dagent.proxy.port= -Dagent.proxy.user= -Dagent.proxy.password= -Dagent.env=prod -Dagent.base.path=/test_user/apps/cloudsecure/agent -...

----
. L'agente dovrebbe essere visibile nella pagina "Agenti" e dovrebbe essere nello stato "connesso".
+
image:ws_agentsPageShowingConnected.png["Interfaccia utente che mostra gli agenti connessi"]

+
.. Pulizia post-installazione.


. Se l'installazione dell'agente ha esito positivo, è possibile eliminare i file di installazione dell'agente scaricati.




== Installazione di un nuovo Data collector.

Nota: questo documento contiene le istruzioni per l'installazione di "ONTAP SVM data collector".  Gli stessi passaggi si applicano a "Cloud Volumes ONTAP data collector" e "Amazon FSx for NetApp ONTAP data collector".

. Accedere al sistema in cui deve essere installato Collector e creare una directory denominata _./tmp/collectors_ nella directory _percorso di installazione dell'agente_.
+
Nota: se l'agente è installato in _/opt/netapp_, passare a _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. Modificare ricorsivamente la proprietà della directory _tmp_ in *cssys:cssys* (l'utente e il gruppo cssys verranno creati durante l'installazione dell'agente).
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. Ora dobbiamo recuperare la versione del collector e l'UUID del collector.  Passare all'API "cloudsecure_config.collector-types".
. Vai su swagger, “cloudsecure_config.collector-types > /v1/cloudsecure/collector-types” (GET) API.  Nel menu a discesa "collectorCategory", seleziona il tipo di collettore come "DATI".  Selezionare "TUTTI" per recuperare tutti i dettagli del tipo di collettore.
. Copiare l'UUID del tipo di collettore richiesto.
+
image:ws_collectorAPIShowingUUID.png["Risposta dell'API del collettore che mostra l'UUID"]

. Scarica il programma di installazione del collettore.
+
.. Passare all'API "cloudsecure_installers.collector > /v1/cloudsecure/collector-types/installers/{collectorTypeUUID}" (GET).  Inserisci l'UUID copiato dal passaggio precedente e scarica il file di installazione.
+
image:ws_downloadCollectorByUUID.png["API per scaricare il collettore tramite UUID"]

.. Se il file di installazione viene scaricato esternamente su un computer diverso, copiare il file di installazione sul sistema in cui è in esecuzione l'agente e posizionarlo nella directory _/{agent-install-path}/cloudsecure/tmp/collectors_.
.. In alternativa, è possibile copiare il comando curl dalla stessa API ed eseguirlo direttamente sul sistema in cui deve essere installato il collettore.
+
Si noti che il nome del file deve essere lo stesso presente nelle intestazioni di risposta dell'API del raccoglitore di download. Vedere lo screenshot qui sotto.

+
Nota: se l'agente è installato in _/opt/netapp_, passare a _/opt/netapp/cloudsecure/tmp/collectors_.

+
image:ws_curl_command.png["Esempio di comando Curl che mostra un token offuscato"]

+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/1829df8a-c16d-45b1-b72a-ed5707129870" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ontap-dsc_1.286.0.zip
----


. Cambia la proprietà del file zip di installazione del collector in *cssys:cssys*.
+
[listing]
----
-rw------- 1 root root 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.286.0.zip
[root@demo-agent collectors]# ll
total 49716
-rw------- 1 cssys cssys 50906252 Apr 26 16:11 cs-ontap-dsc_1.286.0.zip
----
. Passare a *Sicurezza del carico di lavoro > Collettori* e selezionare *+Collettore*.  Selezionare il raccoglitore _ONTAP SVM_.
. Configurare i dettagli del collettore e _Salvare_ il collettore.
. Facendo clic su _Salva_, il processo dell'agente individuerà il programma di installazione del collettore dalla directory _/{agent-install-path}/cloudsecure/tmp/collectors/_ e installerà il collettore.
. In alternativa, anziché aggiungere il collettore tramite l'interfaccia utente, è possibile aggiungerlo anche tramite API.
+
.. Vai su “cloudsecure_config.collectors” > API “/v1/cloudsecure/collectors” (POST).
.. Nel menu a discesa di esempio, seleziona "ONTAP SVM data collector json sample", aggiorna i dettagli di configurazione del collector ed esegui.
+
image:ws_API_add_collector.png["API per aggiungere il collettore"]



. Il collettore dovrebbe ora essere visibile nella sezione "Collettori dati".
+
image:ws_collectorPageList.png["Pagina dell'elenco dell'interfaccia utente che mostra i collezionisti"]

. Pulizia post-installazione.
+
.. Se l'installazione del collector ha esito positivo, tutti i file nella directory _/{agent-install-path}/cloudsecure/tmp/collectors_ possono essere eliminati.






== Installazione di un nuovo User Directory Collector

Nota: in questo documento abbiamo menzionato i passaggi per l'installazione di un raccoglitore LDAP.  Per l'installazione di un raccoglitore AD valgono gli stessi passaggi.

. 1. Accedere al sistema in cui deve essere installato Collector e creare una directory denominata _./tmp/collectors_ nella directory _percorso di installazione dell'agente_.
+
Nota: se l'agente è installato in _/opt/netapp_, passare a _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
+
.. Cambia la proprietà della directory _collectors_ in *cssys:cssys*
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp

[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors

----


. Ora dobbiamo recuperare la versione e l'UUID del collector.  Passare all'API "cloudsecure_config.collector-types".  Nel menu a discesa collectorCategory, seleziona il tipo di collettore come "USER".  Selezionare "TUTTI" per recuperare tutti i dettagli del tipo di collettore in un'unica richiesta.
+
image:ws_API_collector_all.png["API per ottenere tutti i collezionisti"]

. Copia l'UUID del raccoglitore LDAP.
+
image:ws_LDAP_collector_UUID.png["Risposta API che mostra l'UUID del collettore LDAP"]

. Scarica il programma di installazione del collettore.
+
.. Vai su “cloudsecure_installers.collector” > API “/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}” (GET).  Inserisci l'UUID copiato dal passaggio precedente e scarica il file di installazione.
+
image:ws_LDAP_collector_UUID_download.png["API e risposta al raccoglitore di download"]

.. Se il file di installazione viene scaricato esternamente su un computer diverso, copiare il file di installazione nel sistema in cui è in esecuzione l'agente e nella directory _/{agent-installation-path}/cloudsecure/tmp/collectors_.
.. In alternativa, è possibile copiare il comando curl dalla stessa API ed eseguirlo direttamente nel sistema in cui dovrebbe essere installato Collector.
+
Si noti che il nome del file deve essere lo stesso presente nelle intestazioni di risposta dell'API del raccoglitore di download. Vedere lo screenshot qui sotto.

+
Si noti inoltre che se l'agente è installato in _/opt/netapp_, passare a _/opt/netapp/cloudsecure/tmp/collectors_.

+
image:ws_curl_command.png["API del comando Curl"]



+
[listing]
----
[root@demo-agent collectors]# cd {agent-install-path}/cloudsecure/tmp/collectors
[root@demo-agent collectors]# pwd
/opt/netapp/cloudsecure/tmp/collectors

[root@demo-agent collectors]# curl -X GET "https://netapp-demo.dev.cloudsecure.netapp.com/rest/v1/cloudsecure/collector-types/installers/37fb37bd-6078-4c75-a64f-2b14cb1a1eb1" -H "accept: application/octet-stream" -H "X-CloudInsights-ApiKey: <<API Access Token>>" -o cs-ldap-dsc_1.322.0.zip
----
. Cambia la proprietà del file zip del programma di installazione del collettore in cssys:cssys.
+
[listing]
----
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 root root 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ldap-dsc_1.322.0.zip
[root@demo-agent collectors]# ll
total 37156
-rw------- 1 cssys cssys 38045966 Apr 29 10:02 cs-ldap-dsc_1.322.0.zip

----
. Vai alla pagina "Collezionisti directory utente" e clicca su "+ Collezionista directory utente".
+
image:ws_user_directory_collector.png["Aggiunta del raccoglitore di directory utente"]

. Selezionare 'Server directory LDAP'.
+
image:ws_LDAP_user_select.png["Finestra dell'interfaccia utente per la selezione di un utente LDAP"]

. Inserisci i dettagli del server directory LDAP e fai clic su "Salva"
+
image:ws_LDAP_user_Details.png["Interfaccia utente che mostra i dettagli dell'utente LDAP"]

. Facendo clic su _Salva_, il servizio agente individuerà il programma di installazione del collettore dalla directory _/{agent-install-path}/cloudsecure/tmp/collectors/_ e installerà il collettore.
. In alternativa, anziché aggiungere il collettore tramite l'interfaccia utente, è possibile aggiungerlo anche tramite API.
+
.. Vai su “cloudsecure_config.collectors” > API “/v1/cloudsecure/collectors” (POST).
.. Nell'esempio a discesa, seleziona "LDAP Directory Server user collector json sample", aggiorna i dettagli di configurazione del collector e fai clic su "Esegui".
+
image:ws_API_LDAP_Collector.png["API per il raccoglitore LDAP"]



. Il raccoglitore dovrebbe ora essere visibile nella sezione "Raccoglitori directory utente".
+
image:ws_LDAP_collector_list.png["Elenco dei collezionisti LDAP nell'interfaccia utente"]

. Pulizia post-installazione.
+
.. Se l'installazione del collector ha esito positivo, tutti i file nella directory _/{agent-install-path}/cloudsecure/tmp/collectors_ possono essere eliminati.






== Aggiornamento di un agente

Verrà inviata una notifica via e-mail quando sarà disponibile una nuova versione dell'agente/collettore.

. Scarica l'ultimo programma di installazione dell'agente.
+
.. I passaggi per scaricare l'ultimo programma di installazione sono simili a quelli descritti in "Installazione di un nuovo agente".  In Swagger, seleziona “cloudsecure_installers.agent” > API “/v1/cloudsecure/agents/installers/{platform}/latest”, inserisci la piattaforma come “linux” e scarica il file zip dell'installer.  In alternativa, è possibile utilizzare anche il comando curl.  Decomprimere il file di installazione.


. Imposta l'autorizzazione di esecuzione per il file "cloudsecure-agent-upgrade.sh".
+
[listing]
----
[root@demo-agent agent_installers]# unzip cloudsecure-linux-agent-installer-1.618.0.zip
Archive:  cloudsecure-linux-agent-installer-1.618.0.zip
  inflating: cloudsecure-agent-image.zip
  inflating: cloudsecure-agent-install.sh
  inflating: cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rw------- 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip
[root@demo-agent agent_installers]# chmod +x cloudsecure-agent-upgrade.sh
[root@demo-agent agent_installers]# ll
total 153344
-rw------- 1 root root 79154230 Apr 26  2024 cloudsecure-agent-image.zip
-rw------- 1 root root    16574 Apr 26  2024 cloudsecure-agent-install.sh
-rwx------ 1 root root     8586 Apr 26  2024 cloudsecure-agent-upgrade.sh
-rw------- 1 root root 77834660 Apr 26 17:35 cloudsecure-linux-agent-installer-1.618.0.zip

----
. Eseguire lo script “cloudsecure-agent-upgrade.sh”.  Se lo script è stato eseguito correttamente, nell'output verrà visualizzato il messaggio "L'agente Cloudsecure è stato aggiornato correttamente".
. Eseguire il seguente comando 'systemctl daemon-reload'
+
[listing]
----
[root@demo-agent ~]# systemctl daemon-reload
----
. Riavviare il servizio agente.
+
[listing]
----
[root@demo-agent ~]# systemctl restart cloudsecure-agent.service
----
+
A questo punto, l'agente dovrebbe essere stato aggiornato correttamente.

. Controllo di integrità dopo l'aggiornamento dell'agente.
+
.. Passare al percorso in cui è installato l'agente (ad esempio, "/opt/netapp/cloudsecure/").  Il collegamento simbolico "agente" dovrebbe puntare alla nuova versione dell'agente.
+
[listing]
----
[root@demo-agent cloudsecure]# pwd
/opt/netapp/cloudsecure
[root@demo-agent cloudsecure]# ll
total 40
lrwxrwxrwx  1 cssys cssys  114 Apr 26 17:38 agent -> /test_user/apps/cloudsecure/cloudsecure-agent-1.618.0
drwxr-xr-x  4 cssys cssys 4096 Apr 25 10:45 agent-certs
drwx------  2 cssys cssys 4096 Apr 25 16:18 agent-logs
drwx------ 11 cssys cssys 4096 Apr 26 02:50 cloudsecure-agent-1.617.0
drwx------ 11 cssys cssys 4096 Apr 26 17:42 cloudsecure-agent-1.618.0
drwxr-xr-x  3 cssys cssys 4096 Apr 26 02:45 collector-image
drwx------  2 cssys cssys 4096 Apr 25 10:45 conf
drwx------  3 cssys cssys 4096 Apr 26 16:39 data-collectors
-rw-r--r--  1 root  root    66 Apr 25 10:45 sysctl.conf.bkp
drwx------  2 root  root  4096 Apr 26 17:38 tmp

----
.. L'agente dovrebbe essere visibile nella pagina "Agenti" e dovrebbe essere nello stato "connesso".
+
image:ws_agentsPageShowingConnected.png["Interfaccia utente che mostra gli agenti connessi"]



. Pulizia post-installazione.
+
.. Se l'installazione dell'agente ha esito positivo, è possibile eliminare i file di installazione dell'agente scaricati.






== Aggiornamento dei collettori

Nota: i passaggi per l'aggiornamento sono gli stessi per tutti i tipi di collettori.  In questo documento illustreremo l'aggiornamento del collettore "ONTAP SVM".

. Accedere al sistema in cui è necessario aggiornare i collettori e creare la directory _./tmp/collectors_ nella directory _percorso di installazione dell'agente_, se non è già presente.
+
Nota: se l'agente è installato in _/opt/netapp_, passare alla directory _/opt/netapp/cloudsecure_.

+
[listing]
----
[root@demo-agent ~]# cd {agent-install-path}/cloudsecure
[root@demo-agent ~]# mkdir -p ./tmp/collectors
----
. Assicurarsi che la directory “collectors” sia di proprietà di _cssys:cssys_.
+
[listing]
----
[root@demo-agent /]# chown -R cssys:cssys tmp/
[root@demo-agent /]# cd ./tmp
[root@demo-agent tmp]# ll | grep collectors
drwx------ 2 cssys         cssys 4096 Apr 26 15:56 collectors
----
. In Swagger, vai all'API GET "cloudsecure_config.collector-types".  Nel menu a discesa "collectorCategory", seleziona "DATI" (seleziona "UTENTE" per il raccoglitore di directory utente o "TUTTI").
+
Copia UUID e versione dal corpo della risposta.

+
image:ws_collector_uuid_and_version.png["Risposta API che mostra l'UUID del collettore e la versione evidenziati"]

. Scarica l'ultimo file di installazione del collettore.
+
.. Vai a _cloudsecure_installers.collector_ > _/v1/cloudsecure/collector-types/installers/{collectorTypeUUID}_ API.  Inserisci _collectorTypeUUID_ copiato dal passaggio precedente.  Scaricare il programma di installazione nella directory _/{agent-install-path}/cloudsecure/tmp/collectors_.
.. In alternativa, è possibile utilizzare anche il comando curl della stessa API.
+
image:ws_curl_command_only.png["Esempio di comando Curl"]

+
Nota: il nome del file deve essere lo stesso presente nelle intestazioni di risposta dell'API del raccoglitore di download.



. Cambia la proprietà del file zip del programma di installazione del collettore in cssys:cssys.
+
[listing]
----
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 root root 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# chown cssys:cssys cs-ontap-dsc_1.287.0.zip
[root@demo-agent collectors]# ll
total 55024
-rw------- 1 cssys cssys 56343750 Apr 26 19:00 cs-ontap-dsc_1.287.0.zip

----
. Attiva l'API di raccolta degli aggiornamenti.
+
.. In Swagger, vai su “cloudsecure_installers.collector” > API “/v1/cloudsecure/collector-types/upgrade” (PUT).
.. Nel menu a discesa "Esempi", seleziona "ONTAP SVM data collector upgrade json sample" per popolare il payload di esempio.
.. Sostituisci la versione con la versione copiata da<<copy-access-token,Fase 3>> e fare clic su "Esegui".
+
image:ws_svm_ontap_collector_upgrade_example_json.png["Esempio di aggiornamento SVM nell'interfaccia utente di Swagger"]

+
Attendere qualche secondo.  I collezionisti verranno automaticamente aggiornati.



. Controllo di sanità mentale.
+
I collettori dovrebbero essere in stato di esecuzione nell'interfaccia utente.

. Pulizia post-aggiornamento:
+
.. Se l'aggiornamento del collettore ha esito positivo, tutti i file nella directory _/{agent-install-path}/cloudsecure/tmp/collectors_ possono essere eliminati.




Ripetere i passaggi precedenti anche per aggiornare altri tipi di collettori.



== Problemi comuni e relative soluzioni.

. Errore AGENT014
+
Questo errore si verifica se il file di installazione del collettore non è presente nella directory _/{agent-install-path}/cloudsecure/tmp/collectors_ o non è accessibile.  Assicurarsi che il file di installazione sia scaricato e che la struttura completa delle directory di _collectors_ e il file zip di installazione siano di proprietà di cssys:cssys, quindi riavviare il servizio agente: _systemctl restart cloudsecure-agent.service_.

+
image:ws_agent014_error.png["Schermata dell'interfaccia utente che mostra il suggerimento di errore \"agente 014\""]

. Errore non autorizzato
+
[listing]
----
{
  "errorMessage": "Requested public API is not allowed to be accessed by input API access token.",
  "errorCode": "NOT_AUTHORIZED"
}

----
+
Questo errore verrà visualizzato se il token di accesso API viene generato senza selezionare tutte le categorie API richieste.  Genera un nuovo token di accesso API selezionando tutte le categorie API richieste.


